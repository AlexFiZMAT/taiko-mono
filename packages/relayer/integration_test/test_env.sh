#!/bin/bash

source integration_test/docker/docker_env.sh
source integration_test/common.sh

# get deployed contract address.
DEPLOYMENT_JSON=$(cat ../../packages/protocol/deployments/deploy_l1.json)
export SRC_TAIKO_ADDRESS=$(echo "$DEPLOYMENT_JSON" | jq '.taiko' | sed 's/\"//g')
export SRC_SIGNAL_SERVICE_ADDRESS=$(echo "$DEPLOYMENT_JSON" | jq '.signal_service' | sed 's/\"//g')
export SRC_BRIDGE_ADDRESS=$(echo "$DEPLOYMENT_JSON" | jq '.bridge' | sed 's/\"//g')
export SRC_ERC20_VAULT_ADDRESS=$(echo "$DEPLOYMENT_JSON" | jq '.erc20_vault' | sed 's/\"//g')
export SRC_ERC721_VAULT_ADDRESS=$(echo "$DEPLOYMENT_JSON" | jq '.erc721_vault' | sed 's/\"//g')
export SRC_ERC1155_VAULT_ADDRESS=$(echo "$DEPLOYMENT_JSON" | jq '.erc1155_vault' | sed 's/\"//g')
export DEST_ERC20_VAULT_ADDRESS=0x1670010000000000000000000000000000000002
export DEST_ERC721_VAULT_ADDRESS=0x1670010000000000000000000000000000000003
export DEST_ERC1155_VAULT_ADDRESS=0x1670010000000000000000000000000000000004
export DEST_TAIKO_ADDRESS=0x1000777700000000000000000000000000000001
export DEST_BRIDGE_ADDRESS=0x167001000000000000000000000000000000000
export DEST_TAIKO_ADDRESS=0x16700100000000000000000000000000000100011
export SRC_RPC_URL=$L1_NODE_WS_ENDPOINT
export DEST_RPC_URL=$L2_EXECUTION_ENGINE_WS_ENDPOINT
export CONFIRMATIONS_BEFORE_PROCESSING=1
export PROCESSOR_PRIVATE_KEY=59c6995e998f97a5a0044966f0945389dc9e86dae88c7a8412f4603b6b78690d
export DATABASE_USER=root
export DATABASE_PASSWORD=passw00d
export DATABASE_NAME=relayer
export DATABASE_HOST=localhost:$DB_PORT
export DATABASE_MAX_IDLE_CONNS=50
export DATABASE_MAX_OPEN_CONNS=3000
export DATABASE_CONN_MAX_LIFETIME=100000
export QUEUE_USER=guest
export QUEUE_PASSWORD=guest
export QUEUE_HOST=localhost
export QUEUE_PORT=$RABBITMQ_PORT
export VERBOSITY=3
export CORS_ORIGINS=*
export NUM_GOROUTINES=50
export BLOCK_BATCH_SIZE=100
export HEADER_SYNC_INTERVAL_IN_SECONDS=1

echo "
SRC_TAIKO_ADDRESS=$SRC_TAIKO_ADDRESS
SRC_SIGNAL_SERVICE_ADDRESS=$SRC_SIGNAL_SERVICE_ADDRESS
SRC_BRIDGE_ADDRESS=$SRC_BRIDGE_ADDRESS
SRC_ERC20_VAULT_ADDRESS=$SRC_ERC20_VAULT_ADDRESS
SRC_ERC721_VAULT_ADDRESS=$SRC_ERC721_VAULT_ADDRESS
SRC_ERC1155_VAULT_ADDRESS=$SRC_ERC1155_VAULT_ADDRESS
DEST_ERC20_VAULT_ADDRESS=$DEST_ERC20_VAULT_ADDRESS
DEST_ERC721_VAULT_ADDRESS=$DEST_ERC721_VAULT_ADDRESS
DEST_ERC1155_VAULT_ADDRESS=$DEST_ERC1155_VAULT_ADDRESS
DEST_TAIKO_ADDRESS=$DEST_TAIKO_ADDRESS
DEST_BRIDGE_ADDRESS=$DEST_BRIDGE_ADDRESS
DEST_TAIKO_ADDRESS=$DEST_TAIKO_ADDRESS
SRC_RPC_URL=$SRC_RPC_URL
DEST_RPC_URL=$DEST_RPC_URL
CONFIRMATIONS_BEFORE_PROCESSING=$CONFIRMATIONS_BEFORE_PROCESSING
PROCESSOR_PRIVATE_KEY=$PROCESSOR_PRIVATE_KEY
DATABASE_USER=$DATABASE_USER
DATABASE_PASSWORD=$DATABASE_PASSWORD
DATABASE_NAME=$DATABASE_NAME
DATABASE_HOST=$DATABASE_HOST
DATABASE_MAX_IDLE_CONNS=$DATABASE_MAX_IDLE_CONNS
DATABASE_MAX_OPEN_CONNS=$DATABASE_MAX_OPEN_CONNS
DATABASE_CONN_MAX_LIFETIME=$DATABASE_CONN_MAX_LIFETIME
QUEUE_USER=$QUEUE_USER
QUEUE_PASSWORD=$QUEUE_PASSWORD
QUEUE_HOST=$QUEUE_HOST
QUEUE_PORT=$QUEUE_PORT
VERBOSITY=$VERBOSITY
CORS_ORIGINS=$CORS_ORIGINS
NUM_GOROUTINES=$NUM_GOROUTINES
BLOCK_BATCH_SIZE=$BLOCK_BATCH_SIZE
HEADER_SYNC_INTERVAL_IN_SECONDS=$HEADER_SYNC_INTERVAL_IN_SECONDS
JWT_SECRET=$JWT_SECRET
VERBOSITY=$VERBOSITY" > integration_test/.env
